<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" style="background: transparent; background-color: transparent; color-scheme: light dark;" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1766px" height="612px" viewBox="0 0 1766 612"><defs/><g><g data-cell-id="0"><g data-cell-id="1"><g data-cell-id="G-mF6UzgbZvdF5FhRVBf-2"><g><g><svg zoomAndPan="magnify" width="1765" viewBox="0 0 1765 612" version="1.1" style="width: 1765px; height: 612px; background: rgb(255, 255, 255); font-family: initial;" preserveAspectRatio="none" height="612" data-diagram-type="SEQUENCE" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" x="0" y="0"><title>Secuencia Detallada para Crear una Reserva</title><defs/><g><text y="28.2344" x="734.25" textLength="294" lengthAdjust="spacing" font-weight="bold" font-size="14" font-family="sans-serif" fill="#000000">Secuencia Detallada para Crear una Reserva</text><g><title>Frontend (React)</title><rect y="145.8828" x="415" width="10" style="stroke:#181818;stroke-width:1;" height="377.5703" fill="#FFFFFF"/></g><g><title>Backend (Node/Express)</title><rect y="187.7109" x="812" width="10" style="stroke:#181818;stroke-width:1;" height="335.7422" fill="#FFFFFF"/></g><g><title>BBDD (Supabase/Postgres)</title><rect y="266.4961" x="1345.5" width="10" style="stroke:#181818;stroke-width:1;" height="172.2148" fill="#FFFFFF"/></g><rect y="291.4531" x="10" width="1437.5" style="stroke:#000000;stroke-width:1.5;" height="225" fill="none"/><g><title>Cliente</title><rect y="115.9688" x="43.5" width="8" height="417.4844" fill-opacity="0.00000" fill="#000000"/><line y2="533.4531" y1="115.9688" x2="47" x1="47" style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;"/></g><g><title>Frontend (React)</title><rect y="115.9688" x="416" width="8" height="417.4844" fill-opacity="0.00000" fill="#000000"/><line y2="533.4531" y1="115.9688" x2="420" x1="420" style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;"/></g><g><title>Backend (Node/Express)</title><rect y="115.9688" x="813" width="8" height="417.4844" fill-opacity="0.00000" fill="#000000"/><line y2="533.4531" y1="115.9688" x2="817" x1="817" style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;"/></g><g><title>BBDD (Supabase/Postgres)</title><rect y="115.9688" x="1346.5" width="8" height="417.4844" fill-opacity="0.00000" fill="#000000"/><line y2="533.4531" y1="115.9688" x2="1350.5" x1="1350.5" style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;"/></g><g data-participant="Cliente" class="participant participant-head"><text y="114.2188" x="20" textLength="49" lengthAdjust="spacing" font-size="14" font-family="sans-serif" fill="#000000">Cliente</text><ellipse style="stroke:#181818;stroke-width:0.5;" ry="8" rx="8" fill="#E2E2F0" cy="49.4844" cx="47.5"/><path style="stroke:#181818;stroke-width:0.5;" fill="none" d="M47.5,57.4844 L47.5,84.4844 M34.5,65.4844 L60.5,65.4844 M47.5,84.4844 L34.5,99.4844 M47.5,84.4844 L60.5,99.4844"/></g><g data-participant="Cliente" class="participant participant-tail"><text y="545.6875" x="20" textLength="49" lengthAdjust="spacing" font-size="14" font-family="sans-serif" fill="#000000">Cliente</text><ellipse style="stroke:#181818;stroke-width:0.5;" ry="8" rx="8" fill="#E2E2F0" cy="555.9375" cx="47.5"/><path style="stroke:#181818;stroke-width:0.5;" fill="none" d="M47.5,563.9375 L47.5,590.9375 M34.5,571.9375 L60.5,571.9375 M47.5,590.9375 L34.5,605.9375 M47.5,590.9375 L60.5,605.9375"/></g><g data-participant="Frontend" class="participant participant-head"><rect y="85.9844" x="357" width="126" style="stroke:#181818;stroke-width:0.5;" ry="2.5" rx="2.5" height="28.9844" fill="#E2E2F0"/><text y="106.2188" x="364" textLength="112" lengthAdjust="spacing" font-size="14" font-family="sans-serif" fill="#000000">Frontend (React)</text></g><g data-participant="Frontend" class="participant participant-tail"><rect y="532.4531" x="357" width="126" style="stroke:#181818;stroke-width:0.5;" ry="2.5" rx="2.5" height="28.9844" fill="#E2E2F0"/><text y="552.6875" x="364" textLength="112" lengthAdjust="spacing" font-size="14" font-family="sans-serif" fill="#000000">Frontend (React)</text></g><g data-participant="Backend" class="participant participant-head"><rect y="85.9844" x="733" width="168" style="stroke:#181818;stroke-width:0.5;" ry="2.5" rx="2.5" height="28.9844" fill="#E2E2F0"/><text y="106.2188" x="740" textLength="154" lengthAdjust="spacing" font-size="14" font-family="sans-serif" fill="#000000">Backend (Node/Express)</text></g><g data-participant="Backend" class="participant participant-tail"><rect y="532.4531" x="733" width="168" style="stroke:#181818;stroke-width:0.5;" ry="2.5" rx="2.5" height="28.9844" fill="#E2E2F0"/><text y="552.6875" x="740" textLength="154" lengthAdjust="spacing" font-size="14" font-family="sans-serif" fill="#000000">Backend (Node/Express)</text></g><g data-participant="DB" class="participant participant-head"><text y="114.2188" x="1263.5" textLength="168" lengthAdjust="spacing" font-size="14" font-family="sans-serif" fill="#000000">BBDD (Supabase/Postgres)</text><path style="stroke:#181818;stroke-width:1.5;" fill="#E2E2F0" d="M1332.5,64.9844 C1332.5,54.9844 1350.5,54.9844 1350.5,54.9844 C1350.5,54.9844 1368.5,54.9844 1368.5,64.9844 L1368.5,90.9844 C1368.5,100.9844 1350.5,100.9844 1350.5,100.9844 C1350.5,100.9844 1332.5,100.9844 1332.5,90.9844 L1332.5,64.9844"/><path style="stroke:#181818;stroke-width:1.5;" fill="none" d="M1332.5,64.9844 C1332.5,74.9844 1350.5,74.9844 1350.5,74.9844 C1350.5,74.9844 1368.5,74.9844 1368.5,64.9844"/></g><g data-participant="DB" class="participant participant-tail"><text y="545.6875" x="1263.5" textLength="168" lengthAdjust="spacing" font-size="14" font-family="sans-serif" fill="#000000">BBDD (Supabase/Postgres)</text><path style="stroke:#181818;stroke-width:1.5;" fill="#E2E2F0" d="M1332.5,557.4375 C1332.5,547.4375 1350.5,547.4375 1350.5,547.4375 C1350.5,547.4375 1368.5,547.4375 1368.5,557.4375 L1368.5,583.4375 C1368.5,593.4375 1350.5,593.4375 1350.5,593.4375 C1350.5,593.4375 1332.5,593.4375 1332.5,583.4375 L1332.5,557.4375"/><path style="stroke:#181818;stroke-width:1.5;" fill="none" d="M1332.5,557.4375 C1332.5,567.4375 1350.5,567.4375 1350.5,567.4375 C1350.5,567.4375 1368.5,567.4375 1368.5,557.4375"/></g><g><title>Frontend (React)</title><rect y="145.8828" x="415" width="10" style="stroke:#181818;stroke-width:1;" height="377.5703" fill="#FFFFFF"/></g><g><title>Backend (Node/Express)</title><rect y="187.7109" x="812" width="10" style="stroke:#181818;stroke-width:1;" height="335.7422" fill="#FFFFFF"/></g><g><title>BBDD (Supabase/Postgres)</title><rect y="266.4961" x="1345.5" width="10" style="stroke:#181818;stroke-width:1;" height="172.2148" fill="#FFFFFF"/></g><g data-participant-2="Frontend" data-participant-1="Cliente" class="message"><polygon style="stroke:#181818;stroke-width:1;" points="403,141.8828,413,145.8828,403,149.8828,407,145.8828" fill="#181818"/><line y2="145.8828" y1="145.8828" x2="409" x1="47.5" style="stroke:#181818;stroke-width:1;"/><text y="142.2578" x="54.5" textLength="6.5" lengthAdjust="spacing" font-weight="bold" font-size="13" font-family="sans-serif" fill="#000000">1</text><text y="142.2578" x="65" textLength="338" lengthAdjust="spacing" font-size="13" font-family="sans-serif" fill="#000000">Selecciona instalación y horario, y pulsa "Reservar"</text></g><g data-participant-2="Backend" data-participant-1="Frontend" class="message"><polygon style="stroke:#181818;stroke-width:1;" points="800,183.7109,810,187.7109,800,191.7109,804,187.7109" fill="#181818"/><line y2="187.7109" y1="187.7109" x2="806" x1="425" style="stroke:#181818;stroke-width:1;"/><text y="177.1289" x="432" textLength="6.5" lengthAdjust="spacing" font-weight="bold" font-size="13" font-family="sans-serif" fill="#000000">2</text><text y="170.1719" x="442.5" textLength="117" lengthAdjust="spacing" font-size="13" font-family="sans-serif" fill="#000000">POST /api/reservas</text><text y="184.0859" x="442.5" textLength="357.5" lengthAdjust="spacing" font-size="13" font-family="sans-serif" fill="#000000">(Authorization: Bearer &lt;JWT&gt;, {facilityId, date, time})</text></g><g data-participant-2="Backend" data-participant-1="Backend" class="message"><line y2="215.625" y1="215.625" x2="864" x1="822" style="stroke:#181818;stroke-width:1;"/><line y2="228.625" y1="215.625" x2="864" x1="864" style="stroke:#181818;stroke-width:1;"/><line y2="228.625" y1="228.625" x2="864" x1="823" style="stroke:#181818;stroke-width:1;"/><polygon style="stroke:#181818;stroke-width:1;" points="833,224.625,823,228.625,833,232.625,829,228.625" fill="#181818"/><text y="212" x="829" textLength="6.5" lengthAdjust="spacing" font-weight="bold" font-size="13" font-family="sans-serif" fill="#000000">3</text><text y="212" x="839.5" textLength="221" lengthAdjust="spacing" font-weight="bold" font-size="13" font-family="sans-serif" fill="#000000">Validar firma y expiración del JWT</text></g><path style="stroke:#181818;stroke-width:0.5;" fill="#FEFFDD" d="M1082.5,204.2109 L1082.5,227.2109 L1473.5,227.2109 L1473.5,214.2109 L1463.5,204.2109 L1082.5,204.2109"/><path style="stroke:#181818;stroke-width:0.5;" fill="#FEFFDD" d="M1463.5,204.2109 L1463.5,214.2109 L1473.5,214.2109 L1463.5,204.2109"/><text y="221.5" x="1088.5" textLength="370.5" lengthAdjust="spacing" font-size="13" font-family="sans-serif" fill="#000000">Asegura que el usuario está autenticado y tiene permisos.</text><g data-participant-2="DB" data-participant-1="Backend" class="message"><polygon style="stroke:#181818;stroke-width:1;" points="1333.5,262.4961,1343.5,266.4961,1333.5,270.4961,1337.5,266.4961" fill="#181818"/><line y2="266.4961" y1="266.4961" x2="1339.5" x1="822" style="stroke:#181818;stroke-width:1;"/><text y="262.8711" x="829" textLength="6.5" lengthAdjust="spacing" font-weight="bold" font-size="13" font-family="sans-serif" fill="#000000">4</text><text y="262.8711" x="839.5" textLength="494" lengthAdjust="spacing" font-weight="bold" font-size="13" font-family="sans-serif" fill="#000000">INSERT INTO bookings (facility_id, user_id, fecha, hora_inicio) VALUES (...)</text></g><path style="stroke:#181818;stroke-width:0.5;" fill="#FEFFDD" d="M1360,241.625 L1360,278.625 L1758,278.625 L1758,251.625 L1748,241.625 L1360,241.625"/><path style="stroke:#181818;stroke-width:0.5;" fill="#FEFFDD" d="M1748,241.625 L1748,251.625 L1758,251.625 L1748,241.625"/><text y="258.9141" x="1366" textLength="312" lengthAdjust="spacing" font-size="13" font-family="sans-serif" fill="#000000">La tabla 'bookings' tiene una restricción UNIQUE</text><text y="272.8281" x="1372.5" textLength="370.5" lengthAdjust="spacing" font-size="13" font-family="sans-serif" fill="#000000">a nivel de BBDD para prevenir dobles reservas[cite: 183].</text><path style="stroke:#000000;stroke-width:1.5;" fill="#EEEEEE" d="M10,291.4531 L74.5,291.4531 L74.5,297.3672 L64.5,307.3672 L10,307.3672 L10,291.4531"/><rect y="291.4531" x="10" width="1437.5" style="stroke:#000000;stroke-width:1.5;" height="225" fill="none"/><text y="304.7422" x="25" textLength="19.5" lengthAdjust="spacing" font-weight="bold" font-size="13" font-family="sans-serif" fill="#000000">alt</text><text y="303.8516" x="89.5" textLength="115.5" lengthAdjust="spacing" font-weight="bold" font-size="11" font-family="sans-serif" fill="#000000">[Transacción Exitosa]</text><g data-participant-2="Backend" data-participant-1="DB" class="message"><polygon style="stroke:#181818;stroke-width:1;" points="833,323.2813,823,327.2813,833,331.2813,829,327.2813" fill="#181818"/><line y2="327.2813" y1="327.2813" x2="1344.5" x1="827" style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;"/><text y="323.6563" x="839" textLength="6.5" lengthAdjust="spacing" font-weight="bold" font-size="13" font-family="sans-serif" fill="#000000">5</text><text y="323.6563" x="849.5" textLength="195" lengthAdjust="spacing" font-size="13" font-family="sans-serif" fill="#000000">Confirmación de Inserción (OK)</text></g><g data-participant-2="Frontend" data-participant-1="Backend" class="message"><polygon style="stroke:#181818;stroke-width:1;" points="436,365.1094,426,369.1094,436,373.1094,432,369.1094" fill="#181818"/><line y2="369.1094" y1="369.1094" x2="811" x1="430" style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;"/><text y="358.5273" x="442" textLength="6.5" lengthAdjust="spacing" font-weight="bold" font-size="13" font-family="sans-serif" fill="#000000">6</text><text y="351.5703" x="452.5" textLength="104" lengthAdjust="spacing" font-weight="bold" font-size="13" font-family="sans-serif" fill="#000000">HTTP 201 Created</text><text y="365.4844" x="452.5" textLength="221" lengthAdjust="spacing" font-size="13" font-family="sans-serif" fill="#000000">{ "status": "Reserva confirmada" }</text></g><g data-participant-2="Cliente" data-participant-1="Frontend" class="message"><polygon style="stroke:#181818;stroke-width:1;" points="58.5,393.0234,48.5,397.0234,58.5,401.0234,54.5,397.0234" fill="#181818"/><line y2="397.0234" y1="397.0234" x2="414" x1="52.5" style="stroke:#181818;stroke-width:1;"/><text y="393.3984" x="64.5" textLength="6.5" lengthAdjust="spacing" font-weight="bold" font-size="13" font-family="sans-serif" fill="#000000">7</text><text y="393.3984" x="75" textLength="214.5" lengthAdjust="spacing" font-size="13" font-family="sans-serif" fill="#000000">Muestra mensaje de éxito en la UI</text></g><line y2="406.0234" y1="406.0234" x2="1447.5" x1="10" style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;"/><text y="416.4219" x="15" textLength="236.5" lengthAdjust="spacing" font-weight="bold" font-size="11" font-family="sans-serif" fill="#000000">[Conflicto de Concurrencia (Doble Reserva)]</text><g data-participant-2="Backend" data-participant-1="DB" class="message"><polygon style="stroke:#181818;stroke-width:1;" points="833,434.7109,823,438.7109,833,442.7109,829,438.7109" fill="#181818"/><line y2="438.7109" y1="438.7109" x2="1349.5" x1="827" style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;"/><text y="435.0859" x="839" textLength="6.5" lengthAdjust="spacing" font-weight="bold" font-size="13" font-family="sans-serif" fill="#000000">8</text><text y="435.0859" x="849.5" textLength="253.5" lengthAdjust="spacing" font-weight="bold" font-size="13" font-family="sans-serif" fill="#000000">Error de Violación de Constraint UNIQUE</text></g><g data-participant-2="Frontend" data-participant-1="Backend" class="message"><polygon style="stroke:#181818;stroke-width:1;" points="436,476.5391,426,480.5391,436,484.5391,432,480.5391" fill="#181818"/><line y2="480.5391" y1="480.5391" x2="811" x1="430" style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;"/><text y="469.957" x="442" textLength="6.5" lengthAdjust="spacing" font-weight="bold" font-size="13" font-family="sans-serif" fill="#000000">9</text><text y="463" x="452.5" textLength="110.5" lengthAdjust="spacing" font-weight="bold" font-size="13" font-family="sans-serif" fill="#000000">HTTP 409 Conflict</text><text y="476.9141" x="452.5" textLength="318.5" lengthAdjust="spacing" font-size="13" font-family="sans-serif" fill="#000000">{ "error": "Este horario ya no está disponible" }</text></g><g data-participant-2="Cliente" data-participant-1="Frontend" class="message"><polygon style="stroke:#181818;stroke-width:1;" points="58.5,504.4531,48.5,508.4531,58.5,512.4531,54.5,508.4531" fill="#181818"/><line y2="508.4531" y1="508.4531" x2="414" x1="52.5" style="stroke:#181818;stroke-width:1;"/><text y="504.8281" x="64.5" textLength="13" lengthAdjust="spacing" font-weight="bold" font-size="13" font-family="sans-serif" fill="#000000">10</text><text y="504.8281" x="81.5" textLength="214.5" lengthAdjust="spacing" font-size="13" font-family="sans-serif" fill="#000000">Muestra mensaje de error en la UI</text></g></g></svg></g></g></g></g></g></g></svg>